### 前言

#### 网络协议

协议的组成：（三要素）

- 语法：即数据与控制信息的结构格式
- 语义：即需要发出何种控制信息，完成何种动作以及做出何种响应
- 同步：即事件实现顺序的详细说明

协议必须把所有不利的条件事先都估计到，而不能假定一切都是正常的和非常理想的。看一台计算机网络协议是否正确，不能光看在正常情况下是否正确，而且还必须非常仔细地检查这个协议能否应付各种异常情况。

**协议分层**

分层的好处：

- 各层之间相互独立
- 灵活性好
- 结构上可分割开
- 易于实现和维护
- 能促进标准化工作

通常每一层要实现以下功能的一种或多种：

- 差错控制
- 流量控制
- 分段和重装
- 复用和分用
- 连接建立和释放

**分层的缺点：** 有些功能会在不同的层次中重复出现，因此产生了额外开销。

#### 网络交换技术

**交换**——按照某种方式动态地分配传输线路的资源，从输入线路连通输出线路。

三种网络交换技术：电路交换、报文交换、分组交换

***1、电路交换技术：——电话系统***

- 提供面向连接的服务（拨号拿起话筒建立连接，语音数据通信，挂电话释放连接）
- 资源独占(你在打电话时，别人不能打进来会占线)

***2、报文交换技术：——邮政系统***

- 无连接服务（发信前不需要建立连接）
- 存储转发（信件逐站传递）
- 资源共享（邮筒可以同时存放多人的信件，邮筒之间的道路并不会始终被独占。）

  Q：计算机网络该用哪种交换方式？

  A：计算机数据传输的特点

  - 突发性：计算机数据是突发性地出现在传输线路上，其余大部分时间通信线路上是空闲的。
  - 复杂性：可能是一对一通信，但也可能是一对多通信（不能独占资源）。

  计算机网络不适合采用电路交换，否则资源利用率很低，也不适合采用报文交，**计算机网络使用分组交换技术。** 

***3、分组交换技术***

> 核心思想：分组，存储转发，资源共享

- **分组**：将所需传输的较大文件分成多个小的报文
- **存储转发**：分组交换机（路由器）收到分组，先存储到缓存中，然后排队等待处理，最后选择输出链路转发出去。
- **资源共享**：多个用户可以共享一段链路
  一般的链路都是串行传输的，一个时刻只能一个用户占有链路，因此资源共享是宏观的。

分组交换网络的路由选择模式：分组每经过一个路由器，必须决定下一步向何处转发，这个问题就是选路问题，又叫路由选择。

根据分组交换网络的路由选择模式，可以将分组交换网分成以下两种：数据报网络、虚电路网络

**数据报网络：**
- 每个分组的首部均携带完整的目标地址。
- 路由器收到分组后，根据分组首部携带的目标地址选择当前最优的下一条路。
- 同一个报文的不同分组各自独立选路因此可能沿不同的路径传输。
- 分组在传输过程中可能需要排队，甚至被丢弃，分组也不一定能够按序到达。

**虚电路网络：** 
- 传输数据前需要先建立一条虚拟的电路，沿途的路由器负责维持该虚电路的状态。
- 每个分组的首部携带虚电路号。
- 路由器收到分组后，根据分组首部携带的虚电路号来决定分组的转发。
- 建立虚电路后，该次通信中所有后续分组均通过同一固定路径快速有序的传送。
- ATM和帧中继网络使用虚电路网络

***虚电路网络过程***：发送分组之前会建立一条虚拟的电路，每个分组携有标签  (虚电路 ID), 由标签来确定下一跳，在连接建立阶段确定固定的路由,全部数据通过同一条路传递，路由器为每个正在通信中的连接维持状态。

***4、时延***

**传输时延（发送时延 ）**——发送数据时，数据块从结点进入到传输媒体所需要的时间。也就是从发送数据帧的第一个比特算起，到该帧的最后一个比特发送完毕所需的时间。 

> 发送时延=数据块长度(比特)/信道带宽(比特/秒)

**传播时延**——电磁波在信道中需要传播一定的距离而花费的时间。信号传输速率（即发送速率）和信号在信道上的传播速率是完全不同的概念。 

> 传播时延=信道长度(米)/信号在信道上的传播速率(米/秒)

数据经历的总时延就是发送时延、传播时延、处理时延和排队时延之和：

>  总时延 = 发送时延+传播时延+处理时延+处理时延



### 计算机网络分层（OSI七层、TCP/IP四层）

OSI(Open [System](http://www.ha97.com/tag/system) Interconnect，意为开放式系统互联) 参考模型是由国际标准化组织于1977年制定的，这是一个计算机互连的国际标准。

ISO 制定这一国际标准的宗旨就是使任何一种计算机系统无论位于世界任何地方，只要符合 **OSI 标准** 就能和另一个遵守 OSI 标准的计算机系统实现互联通信。

OSI 模型分为7层：从下到上依次是物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。

**OSI七层参考模型的各个层次的划分遵循下列原则：**

1. 同一层中的各网络节点都有相同的层次结构，具有同样的功能。
2. 同一节点内相邻层之间通过接口（可以是逻辑接口）进行通信。
3. 七层结构中的每一层使用下一层提供的服务，并且向其上层提供服务。
4. 不同节点的同等层按照协议实现对等层之间的通信。

**OSI 参考模型概念清楚，理论较完整，但它既复杂又不实用**。

而 **TCP/IP 体系结构**却不同，是目前**最流行的商业化网络协议**，虽然不是标准化组织提出的正式标准，但它已经被公认为目前的工业标准或 “事实标准” ，已经得到了广泛的应用。**但是实质上讲，TCP/IP只有最上面就的三层，因为最下面的网络接口层基本没什么内容。**

OSI 采用7层体系结构，TCP/IP 采用4层体系结构（如下）

但我们再学习计算机网络的原理时往往***采取折中的方法***，综合 OSI 和 TCP/IP 的优点，采取一种**只有五层协议的体系结构**（如下）

![](https://img-1256179949.cos.ap-shanghai.myqcloud.com/18-5-6-89658679.jpg)





**第一层：物理层**

> 规定通信设备的机械的、电气的、功能的和过程的特性，用以建立、维护和拆除物理链路连接。具体地讲，**机械特性**规定了网络连接时所需接插件的规格尺寸、引脚数量和排列情况等；**电气特性**规定了在物理连接上传输bit流时线路上信号电平的大小、阻抗匹配、传输速率 距离限制等；**功能特性**是指对各个信号先分配确切的信号含义，即定义了DTE和DCE之间各个线路的功能；**规程特性**定义了利用信号线进行bit流传输的一组操作规程，是指在物理连接的建立、维护、交换信息是，DTE和DCE双放在各电路上的动作系列。在这一层，数据的单位称为比特（bit）。属于物理层定义的典型规范代表包括：EIA/TIA RS-232、EIA/TIA RS-449、V.35、RJ-45等。
>
> PS：在物理层上所传数据的单位是**比特**，物理层的任务就是透明地传送比特流。

**第二层：数据链路层**

> 在物理层提供比特流服务的基础上，建立相邻结点之间的数据链路，通过差错控制提供数据帧（Frame）在信道上无差错的传输，并进行各电路上的动作系列。数据链路层在不可靠的物理介质上提供可靠的传输。该层的作用包括：物理地址寻址、数据的成帧、流量控制、数据的检错、重发等。在这一层，数据的单位称为帧（frame）。数据链路层协议的代表包括：SDLC、HDLC、PPP、STP、帧中继等。
>
> 链路层将网络层交下来的 IP 数据报组装成帧，在两个相邻结点之间的链路上**透明地**传送帧中的数据。控制端在接收数据时，控制信息使接收端能够知道一个帧从哪个比特开始和到哪个比特结束。这样，数据链路层在收到一个帧后，就可从中提取出数据部分，上交给网络层。控制信息还使得接收端能够检测到所收到的帧中有无差错。如果发现有差错，数据链路层就简单地丢弃这个出错的帧，以免传下去白白浪费网络资源。**如果需要改正错误，就由运输层的TCP协议来完成。(数据信息的确认交给更高层的网络层或者应用层实现)**

**第三层：网络层**

> 在计算机网络中进行通信的两个计算机之间可能会经过很多个数据链路，也可能还要经过很多通信子网。网络层的任务就是选择合适的网间路由和交换结点， 确保数据及时传送。网络层将数据链路层提供的帧组成数据包，包中封装有网络层包头，其中含有逻辑地址信息- -源站点和目的站点地址的网络地址。如果你在谈论一个 IP 地址，那么你是在处理第3层的问题，这是“数据包”问题，而不是第2层的“帧”。IP 是第3层问题的一部分，此外还有一些路由协议和地址解析协议（ARP）。有关路由的一切事情都在这第3层处理。地址解析和路由是3层的重要目的。网络层还可以实现拥塞控制、网际互连等功能。在这一层，数据的单位称为数据包（packet）。网络层协议的代表包括：IP、IPX、RIP、OSPF等。
>
> 网络层负责为分组交换网上的**不同主机提供通信服务**。
>
> 1. (作用1)在发送数据时，网络层把运输层产生的报文段或用户数据报**封装成分组或包**进行传送。在TCP/IP体系中，由于网络层使用IP协议，因此分组也叫做**IP数据报**，简称数据报。
>
>
> 2. (作用2)网络层的另一个任务就是要**选择合适的路由**，使源主机运输层所传下来的分组，能够通过网络中的路由器找到目的主机。

**第四层：运输层**

> 第4层的数据单元也称作**数据包**（packets）。但是，当你谈论 TCP 等具体的协议时又有特殊的叫法，TCP 的数据单元称为段 （segments），而UDP协议的数据单元称为“数据报（datagrams）”。这个层负责获取全部信息，因此，它必须跟踪数据单元碎片、乱序到达的数据包和其它在传输过程中可能发生的危险。第4层为上层提供端到端（最终用户到最终用户）的透明的、可靠的数据传输服务。所为透明的传输是指在通信过程中 传输层对上层屏蔽了通信传输系统的具体细节。传输层协议的代表包括：TCP、UDP、SPX等。
>
> 运输层为两个主机中的**进程间的通信**提供服务。运输层主要使用以下两种协议：TCP和UDP。
>
> - TCP：传输控制协议，面向连接的，数据传输的单位是报文段，能够提供可靠地交付。
> - UDP：用户数据报协议，无连接的，数据传输的单位是用户数据报，不保证提供可靠地交付。

**第五层：会话层**

> 这一层也可以称为会晤层或对话层，在会话层及以上的高层次中，数据传送的单位不再另外命名，而是统称为报文。会话层不参与具体的传输，它提供包括访问验证和会话管理在内的建立和维护应用之间通信的机制。如服务器验证用户登录便是由会话层完成的。

**第六层是表示层**

> 这一层也可以称为会晤层或对话层，在会话层及以上的高层次中，数据传送的单位不再另外命名，而是统称为报文。会话层不参与具体的传输，它提供包括访问验证和会话管理在内的建立和维护应用之间通信的机制。如服务器验证用户登录便是由会话层完成的。

**第六层：表示层**

> 这一层主要解决拥护信息的语法表示问题。它将欲交换的数据从适合于某一用户的抽象语法，转换为适合于OSI系统内部使用的传送语法。即提供格式化的表示和转换数据服务。数据的压缩和解压缩， 加密和解密等工作都由表示层负责。

**第七层：应用层**

> 应用层是体系结构中的最高层，它直接为用户的**应用程序**提供服务，在因特网中应用层的协议很多，如支持万维网应用的**HTTP协议**，支持电邮的**SMTP协议**，支持文件传输的**FTP协议**等等。
>
> 应用层为操作系统或网络应用程序提供访问网络服务的接口。



**OSI七层网络模型：**

| OSI                         | 功能                                                         | TCP/IP协议                                  |
| --------------------------- | ------------------------------------------------------------ | ------------------------------------------- |
| 应用层(Application Layer)   | 面向计算机用户，提供应用程序和网络之间的接口，向用户提供服务，完成用户希望在网上完成的各种工作 | HTTP，HTTPS，FTP，TELNET，SSH，SMTP，POP3等 |
| 表示层(Presentation Layer)  | 处理来自应用层的的命令和数据，对各种语法解释，按照规格传给会话层。处理编码，数据可是转换和加密解密 | 没有协议                                    |
| 会话层(Session Layer)       | 用户应用程序和网络之间的接口，向两个实体表示层提供连接和连接方法，不同实体之间的表示层连接叫做会话，因此主要功能是维护和协调会话之间的数据通信 | 没有协议                                    |
| 传输层(Transport Layer)     | 为会话层和网络层提供传输服务，从会话层获得数据，在必要时进行分割，然后传送给网络层，主要起到建立，维护和取消传输连接功能，负责两节点的可靠传输 | TCP、UDP                                    |
| 网络层(Network Layer)       | 通过路由算法(两节点之间可能有多条路径)，为报文选择最适当的路径，在网络层数据转换为数据包，通过路径选择等控制，将信息从一个网络设备传送到另一个网络设备 | IP、ICMP、RIP、OSPF、BGP、IGMP等            |
| 数据链路层(Data Link Layer) | 数据链路层的数据传输单元成为帧，就是将网络层转发的数据封装为帧，传输给物理层，以及分析物理层传输过来的数据帧 | SLIP、CSLIP、PPP、ARP、RARP、MTU等          |
| 物理层(Physical Layer)      | 为数据链路层提供数据帧和接收数据帧然后管理电脑通信设备和网络媒体之间的互通。包括了针脚、电压、线缆规范、集线器、中继器、网卡、主机适配器等 | ISO2110等                                   |

![](https://img-1256179949.cos.ap-shanghai.myqcloud.com/18-5-6-30548659.jpg)

**TCP/IP模型：**

| OSI                  | TCP/IP     | 协议                             |
| -------------------- | ---------- | -------------------------------- |
| 应用层/表示层/会话层 | 应用层     | HTTP、FTP、TFTP、SMIP、SNMP、DNS |
| 传输层               | 传输层     | TCP、UDP                         |
| 网络层               | 网络层     | ICMP、IGMP、IP、ARP、RARP        |
| 数据链路层/物理层    | 网络接口层 | 由底层网络定义协议               |

**TCP/IP分层模型图：**

![](https://img-1256179949.cos.ap-shanghai.myqcloud.com/18-5-6-52842405.jpg)

**数据包说明：**

IP 层传输单位是 IP 分组，属于点到点的传输；TCP 层传输单位是 TCP 段，属于端到端的传输。

![](https://img-1256179949.cos.ap-shanghai.myqcloud.com/18-5-6-67946435.jpg)

![](https://img-1256179949.cos.ap-shanghai.myqcloud.com/18-5-6-37548861.jpg)



参考：

- [OSI七层与TCP/IP五层网络架构详解](http://www.ha97.com/3215.html)


- [【网络基础】OSI TCP/IP体系结构](https://blog.csdn.net/cout_sev/article/details/25164469)
- [OSI/TCP/IP深入浅出](https://juejin.im/post/5a7aacf45188257a6a78b561)
- [OSI七层协议模型、TCP/IP四层模型学习笔记](https://blog.csdn.net/guoguo527/article/details/52078962)

